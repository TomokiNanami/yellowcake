---
template: SinglePost
title: ヒヨコードをリファクタリングして気づいた読みづらいソースコードの特徴(の一部)
status: Published
date: 2019-05-23T13:06:09.191Z
excerpt: 'javascript, readable_code, refactoring'
categories:
  - category: Javascript
  - category: Readable Code
meta: {}
---
今回は技術というよりは実体験をもとにした記事になります。なので唐突なですます口調です。  

４月から新しい現場になり、５月のGW明けから本格的にソースコードを触るようになりました。  
言語は自分の中で一番得意な`Javascript`, `Node.js`。コードリーディングも特に難なく進んでいきました。  


...とはならず、かなり処理や仕様を追っていくのに苦労しました。(しかもクライアントサイドは`jQuery`...)ちょっとこのままでは機能拡張ができないのでリファクタリングをしつつ作業を進めました。

そこで今回はこのリファクタリングを通して気づいた(Javascriptにおける)**読みづらいコードの特徴と個人的リファクタ法**を挙げていこうと思います。  

**一応リーダブルコードやオブジェクト指向の本をいくつか読んだり実践してるつもりですが、人によって書き方が異なる部分もあると思います。あくまで参考程度に...。**  

## 1. 変数の宣言は使用する直前、またはなるべく近い場所で行う。
変数の宣言は必要になる処理の直前か限りなく近い場所で行うようにしたほうがいいです。処理追っているときは次から次へと変数などが出てくるのであまりにも離れているところにあるのは覚えてられません。あと単純にPCの画面をスクロールしないと見えないってのはつらい。
悪い例
```
const hoge = 100;

.
.  数十行の処理...
.

// ここでようやく出てくる。
array.forEach(el => {
    const num = hoge + 100;
    .
    .
    .
});
```
良い例
```
// 使う直前かなるべく近いところで宣言する。
const hoge = 100;
array.forEach(el => {
    const num = hoge + 100;
});
```
## 変数宣言は基本`const`再代入の場合`let`を使う。
既にいろんな記事で出ていると思いますがこれは本当にそう。`const`を宣言するだけでその値は不変であることがわかります。(ただし**配列とオブジェクトの中身は変更できてしまうので注意**)  
どうしても値が変化する場合は`let`を使います。  
`var`の場合ブロックスコープ内で同名の変数を宣言したとき、外側のスコープの同名変数の値も変わってしまいます。対して`let`の場合はスコープが**ブロックスコープになるため外側のスコープに影響がありません。**  
例を見てみます。
```
// -- varの場合
var hoge = 100;
console.log(`外側 hoge: ${hoge}`);
{
    var hoge = 200;
    console.log(`内側 hoge: ${hoge}`);
}
console.log(`再度外側 hoge: ${hoge}`);
// 出力結果
外側 hoge: 100
内側 hoge: 200
再度外側 hoge: 200 // 外側まで変わっている。

// letの場合
let hoge = 100;
console.log(`外側 hoge: ${hoge}`);
{
    let hoge = 200;
    console.log(`内側 hoge: ${hoge}`);
}
console.log(`再度外側 hoge: ${hoge}`);
// 出力結果
外側 hoge: 100
内側 hoge: 200
再度外側 hoge: 100 // 影響無し。
```
ちなみに先ほども言いましたが、配列とオブジェクトは`const`を付けたとしても、要素の変更、追加、削除は出来てしまいます。その時自分は、**要素の操作が入る場合は`let`、一切変更のない場合は`const`**を付けて表現しています。

## boolean値を格納するフラグについて
boolean値を扱う場合、変数名は`is〇〇`だったり`has〇〇`、`〇〇able`など、trueだった時falseだった時の意味がわかるようなものにしましょう。**`flag`だけの変数名なんてもってのほかです！！！**  
あとたまによく見るんですが、下のようなコード
```
if (isHoge === false) {
    // 処理
}
```
`false`の時`true`という頭がこんがらがりそうな条件式。これは単純に、
```
if (!isHoge) {
    // 処理
}
```
で良いですよね笑。

ひとまず現場のソースコードをリファクタリングしてて特に印象に残ったものを挙げてみました。  
良いコードを書いたり読んだりすることも大事ですが、逆にヒヨコードを見ると**どういうコードが読みづらいのか**というのがわかるのでそれはそれで勉強なりますよね。  

これからも意識してゴリゴリコード書いていきましょ～～～～～～(｀・ω・´)ｼｬｷｰﾝ
